package com.ogasawara.ogavulnweb.web;

import java.util.List;

import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;

import com.ogasawara.ogavulnweb.domain.Vulnerability;
import com.ogasawara.ogavulnweb.service.VulnerabilityService;

/**
 * 脆弱性コントローラ
 * @author a14541
 *
 */
@Controller
@RequestMapping("vulnerability")
public class VulnerabilityController {

	/** 脆弱性サービス */
	@Autowired
	VulnerabilityService vulnerabilityService;
	
	/** 脆弱性Form */
	@ModelAttribute
	VulnerabilityForm setUpForm(){
		return new VulnerabilityForm();
	}

	/**
	 * リスト表示
	 * @param model
	 * @return
	 */
	@GetMapping
	String list(Model model){
		List<Vulnerability> vulns = vulnerabilityService.findAll();
		model.addAttribute("vulnerabilities", vulns);
		return "vulnerability/list";
	}

	/**
	 * 新規データ作成
	 * @param form 脆弱性フォーム
	 * @param result入力チェック結果
	 * @param model
	 * @return
	 */
	@PostMapping(path = "create")
	String create(@Validated VulnerabilityForm form
					,BindingResult result, Model model){
		// 入力チェック結果判定
		if(result.hasErrors()){
			return list(model);
		}

		Vulnerability vulnerability = new Vulnerability();
		BeanUtils.copyProperties(form, vulnerability);
		vulnerabilityService.create(vulnerability);

		return "redirect:/vulnerability";
	}
}
